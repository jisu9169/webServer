<!DOCTYPE html>
<html lang="ko">

<head>
  <meta charset="UTF-8">
  <title>ì±… ëª©ë¡</title>
  <link rel="stylesheet" href="./stylesheets/style.css">
</head>

<body>
  <h1>ğŸ“š ì±… ëª©ë¡</h1>
  <ul id="book-list">
    <% books.forEach((book)=> {%>
      <li data-id="<%= book.id %>">
        <span class="book-title" style="cursor:pointer; color:blue; text-decoration:underline;">
          <%= book.title %>
        </span>
        <!-- ì‚­ì œ ë²„íŠ¼ -->
        <button class="delete-btn">ì‚­ì œ</button>
        <!-- ìˆ˜ì • ë²„íŠ¼(ìˆ˜ì •í˜ì´ì§€ ì´ë™ GET) -->
        <form action="/form/<%=book.id%>" style="display:inline;">
          <button type="submit">ìˆ˜ì •</button>
        </form>
      </li>
      <% }); %>
  </ul>

  <h2>ìƒˆ ì±… ì¶”ê°€</h2>
  <!-- í˜„ì¬ ê²½ë¡œ : [GET] localhost:3000/books -->
  <!-- ì¶”ê°€ ìš”ì²­ : [POST] localhost:3000/books -->
  <form action="/books" method="post">
    <input type="text" placeholder="ì œëª©" name="title" required>
    <input type="text" placeholder="ì €ì" name="author" required>
    <button type="submit">ì¶”ê°€</button>
  </form>

  <h2>ğŸ“– ì„ íƒí•œ ì±… ìƒì„¸ì •ë³´</h2>
  <div id="book-detail">ì œëª©ì„ í´ë¦­í•˜ë©´ ìƒì„¸ì •ë³´ê°€ ì—¬ê¸°ì— í‘œì‹œë©ë‹ˆë‹¤.</div>

  <script>
    // ì‚¬ìš©ìë“¤ì€ ì±… ì œëª©ì„ í´ë¦­(íƒœê·¸ -> <span class ='book-title'> => ë°˜ë³µë¬¸ ì‚¬ìš© ê° íƒœê·¸ì— ì´ë²¤íŠ¸ ì ìš©)
    // getElementById = HTMLElement( ìš”ì†Œ 1ê°œ)
    // querySelectorAll => HTMLCollection(ë°°ì—´ê³¼ ë¹„ìŠ·)
    document.querySelectorAll('.book-title').forEach((titleEl) => {
      // titleEl(spaníƒœê·¸) : í•´ë‹¹ íƒœê·¸ê°€ í´ë¦­ë˜ì—ˆì„ ë•Œ í•´ë‹¹ ë¶€ë¶„ì— ì¶œë ¥ë˜ì–´ ìˆëŠ” ì±…ì˜ ìƒì„¸ì •ë³´ë¥¼ ìš”ì²­

      titleEl.addEventListener('click', async (e) => { // e : í´ë¦­ì´ë²¤íŠ¸ê°€ ë°œìƒí•˜ë©´ ìë™ìœ¼ë¡œ ë“¤ì–´ì˜¤ëŠ” ê°ì²´(ì´ë²¤íŠ¸ì— ëŒ€í•œ ì •ë³´)
        const li = e.target.closest('li'); // í´ë¦­í•œ sapn íƒœê·¸ë¥¼ ê°ì‹¸ëŠ” liíƒœê·¸ ê°€ì§€ê³ ì˜´!
        const bookId = li.getAttribute('data-id'); // 1, 2 ~
        console.log(bookId);

        // fetch í™œìš© ì„œë²„ë¡œ ì±… ìƒì„¸ì •ë³´ ìš”ì²­
        // 1. then() .. ~ : ì½œë°±í•¨ìˆ˜
        // 2. async/await : ì½”ë“œê°€ ê°„ëµí•´ì§
        const res = await fetch(`/books/${bookId}`);

        const book = await res.json(); // json() ==> ë¹„ë™ê¸°
        console.log(book);
        let html = '<p>id : ' + book.id + '</p>';
        html += '<p> title :' + book.title + '</p>';
        html += '<p> author :' + book.author + '</p>';
        // innerHTML : íƒœê·¸ í¬í•¨
        // innerText : í…ìŠ¤íŠ¸ë§Œ í¬í•¨
        document.getElementById('book-detail').innerHTML = html;
      });
    });

  </script>
</body>

</html>